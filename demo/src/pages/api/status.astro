---
import StatusToggle from "../../components/StatusToggle.astro";

// Parse form data
const formData = await Astro.request.formData();
const username = formData.get("username") as string;
const currentStatus = formData.get("currentStatus") as string;
const newStatus = formData.get("newStatus") as 'online' | 'away' | 'offline';

// 20% chance of error for demonstration
if (Math.random() < 0.2) {
  return new Response("Status update failed", { status: 500 });
}

// Simulate processing time
await new Promise(resolve => setTimeout(resolve, 800));
---

<StatusToggle 
  status={newStatus} 
  username={username} 
/>