(()=>{var t="hx-optimistic",e="hx-optimistic-error",r="hx-optimistic-reverting",n="optimistic";function s(t,e){let r=t;for(;r;){const t=r.querySelector(e);if(t)return t;r=r.parentElement}return null}function i(t,e,r={}){return"string"!=typeof t?t:t.replace(/\${([^}]+)}/g,(t,n)=>{if(n=n.trim(),void 0!==r[n])return r[n];if(!e)return t;if("this.value"===n){if(void 0!==e.value)return e.value;if("FORM"===e.tagName){const t=e.querySelector("input, textarea, select");if(t?.value)return t.value}}if("FORM"===e.tagName){const t={textarea:"textarea",email:'input[type="email"]',password:'input[type="password"]',text:'input[type="text"], input:not([type])',url:'input[type="url"]',tel:'input[type="tel"]',search:'input[type="search"]'}[n]||`[name="${n}"]`,r=e.querySelector(t);if(r?.value)return r.value}if("this.textContent"===n)return e.textContent||t;if(n.startsWith("this.dataset.")){const r=n.slice(13);return e.dataset[r]||t}if(n.startsWith("data:")){const r=n.slice(5).replace(/-([a-z])/g,(t,e)=>e.toUpperCase());return e.dataset[r]||t}if(n.startsWith("attr:")){const r=n.slice(5);return e.getAttribute(r)||t}return(n.includes(".")||n.includes(":"))&&console.warn(`[hx-optimistic] Unresolved interpolation pattern: \${${n}}`,"\nSupported patterns:","\n  ${this.value} - element value","\n  ${this.textContent} - element text content","\n  ${this.dataset.key} - data attribute","\n  ${data:key} - data attribute shorthand","\n  ${attr:name} - any attribute","\n  ${textarea}, ${email}, ${password}, etc. - form field by type","\n  ${fieldName} - form field by name","\n  ${status}, ${statusText}, ${error} - error context","\nSee documentation for details."),t})}function a(t,e){if(!e||"this"===e)return t;const r=String(e).trim(),n=r.split(/\s+/);if(["closest","find","next","previous"].some(t=>r.startsWith(t))){let e=t;for(let t=0;t<n.length;){const r=n[t++],i=n[t++]||"";if("closest"===r){let t=e?e.closest(i):null;if(t||(t=s(e,i)),e=t,!e)return null}else if("find"===r){if(!e)return null;let t=e.querySelector(i);if(!t){let r=e.parentElement;for(;r&&!t&&(t=r.querySelector(i),!t);)r=r.parentElement}if(e=t||null,!e)return null}else if("next"===r){if(!e)return null;let t=e.nextElementSibling,r=null;for(;t;){if(t.matches(i)){r=t;break}t=t.nextElementSibling}if(e=r,!e)return null}else{if("previous"!==r)return null;{if(!e)return null;let t=e.previousElementSibling,r=null;for(;t;){if(t.matches(i)){r=t;break}t=t.previousElementSibling}if(e=r,!e)return null}}}return e}return document.querySelector(r)}function o(n,s){n?.classList&&(n.classList.remove(t,e,r),"optimistic"===s?n.classList.add(t):"error"===s?n.classList.add(e):"reverting"===s&&n.classList.add(r))}function l(t){"undefined"!=typeof htmx&&"function"==typeof htmx.process&&htmx.process(t)}function c(t,e){if(!t?.dataset?.[n])return null;const r=t.dataset[n],s=e.get(t);if(s&&s.__raw===r)return s.config;let i;try{"true"===r||""===r?i={}:(i=JSON.parse(r),"object"==typeof i&&null!==i||(i={values:{textContent:r}}))}catch(t){i={values:{textContent:r}}}return i.delay=i.delay??2e3,i.errorMode=i.errorMode||"replace",i.errorMessage=i.errorMessage||"Request failed",i.values||i.template||"BUTTON"!==t.tagName||(i.values={className:(t.className+" hx-optimistic-pending").trim()}),e.set(t,{__raw:r,config:i}),i}function u(t){const e=new WeakMap,r=new WeakMap,s=new WeakMap,u=new WeakMap;return{onEvent:function(t,e){"htmx:beforeRequest"===t?this.handleBeforeRequest(e):["htmx:responseError","htmx:swapError","htmx:timeout","htmx:sendError"].includes(t)?this.handleError(e):"htmx:afterSwap"===t&&this.cleanup(e.target)},handleBeforeRequest:function(r){const i=r.target;if(l=i,!Boolean(l?.dataset?.[n]))return;var l;const f=c(i,e);if(!f)return;const d=function(t){const e=t.getAttribute("hx-target");return e?a(t,e):t}(i);if(!d)return void console.warn("[hx-optimistic] Target element not found for:",i);u.set(i,d);const p=function(t,e){const r=(e.get(t)||0)+1;return e.set(t,r),r}(d,s);this.snapshot(d,i,f,p),this.applyOptimistic(d,i,f),o(d,"optimistic"),function(t,e){e&&e.class&&t?.classList&&t.classList.add(e.class)}(d,f);try{t.trigger&&t.trigger(d,"optimistic:applied",{config:f})}catch(t){}},handleError:function(n){const i=n.detail?.elt||n.target,l=i?.getAttribute("hx-target"),f=(l?a(i,l):null)||u.get(i)||i;if(!f)return;const d=r.get(f),p=d?.config||c(i,e);if(!p)return;const m=s.get(f);if(d&&d.token!==m)return;const h=document.activeElement;if(h&&f.contains(h)){const t=r.get(f)||{config:p,token:m};t.focusRestore=h,r.set(f,t)}o(f,"error"),this.showError(f,p,n);try{const e={status:n.detail?.xhr?.status||0,statusText:n.detail?.xhr?.statusText||"Network Error",error:n.detail?.error||"Request failed"};t.trigger&&t.trigger(f,"optimistic:error",{config:p,detail:e})}catch(t){}p.delay>0&&setTimeout(()=>this.revert(f,m),p.delay)},snapshot:function(t,e,n,s){const i=Array.from(t.attributes).reduce((t,{name:e,value:r})=>(t[e]=r,t),{}),a={...t.dataset},o=Array.isArray(n.snapshot)&&n.snapshot.length>0?n.snapshot:["innerHTML","className"],l={};o.forEach(e=>{"textContent"===e?l.textContent=t.textContent:"innerHTML"===e?l.innerHTML=t.innerHTML:"className"===e?l.className=t.className:e.startsWith("data-")?l[e]=t.dataset[e.slice(5)]:e in t&&(l[e]=t[e])});const c={innerHTML:t.innerHTML,className:t.className,attributes:i,dataset:a,granular:l,config:n,token:s};r.set(t,c)},applyOptimistic:function(t,e,r){let n=t;if(r.target){const t=a(e,r.target);t&&(n=t)}if(r.template){const t=this.getTemplate(r.template);if(t){const s=i(t,e,r&&"object"==typeof r.context?r.context:{});"beforeend"===r.swap?n.insertAdjacentHTML("beforeend",s):"afterbegin"===r.swap?n.insertAdjacentHTML("afterbegin",s):(n.innerHTML=s,l(n))}else"string"==typeof r.template&&r.template.startsWith("#")&&console.warn("[hx-optimistic] Template selector did not resolve:",r.template)}else r.values&&this.applyValues(n,r.values,e)},showError:function(t,e,r){if(!t.dataset.hxOptimisticErrorShown)if(t.dataset.hxOptimisticErrorShown="true",e.errorTemplate){const n=this.getTemplate(e.errorTemplate);if(n){const s=e&&"object"==typeof e.context?e.context:{},a=Object.assign({},s,{status:r.detail?.xhr?.status||0,statusText:r.detail?.xhr?.statusText||"Network Error",error:r.detail?.error||"Request failed"}),o=i(n,r.detail?.elt||r.target,a);if("append"===e.errorMode){const e=document.createElement("div");e.className="hx-optimistic-error-message",e.innerHTML=o,t.appendChild(e)}else t.innerHTML=o}else"string"==typeof e.errorTemplate&&e.errorTemplate.startsWith("#")&&console.warn("[hx-optimistic] Error template selector did not resolve:",e.errorTemplate)}else if(e.errorMessage)if("append"===e.errorMode){const r=document.createElement("div");r.className="hx-optimistic-error-message",r.textContent=e.errorMessage,t.appendChild(r)}else t.textContent=e.errorMessage},revert:function(e,n){const i=r.get(e);if(!i)return;if(void 0!==n&&i.token!==n)return;o(e,"reverting"),void 0!==i.innerHTML&&(e.innerHTML=i.innerHTML),void 0!==i.className&&(e.className=i.className);try{Array.from(e.getAttributeNames()).forEach(t=>e.removeAttribute(t)),Object.entries(i.attributes||{}).forEach(([t,r])=>e.setAttribute(t,r))}catch(t){}try{Object.keys(e.dataset||{}).forEach(t=>delete e.dataset[t]),Object.assign(e.dataset,i.dataset||{})}catch(t){}r.delete(e),s.delete(e),this.cleanup(e),l(e);const a=i.focusRestore;if(a&&document.contains(a))try{a.focus()}catch(t){}try{t.trigger&&t.trigger(e,"optimistic:reverted",{config:i.config})}catch(t){}},cleanup:function(t){if(!t)return;o(t,"clean"),t.querySelectorAll(".hx-optimistic-error-message").forEach(t=>t.remove()),function(t){t?.dataset&&Object.keys(t.dataset).filter(t=>t.startsWith("hxOptimistic")).forEach(e=>delete t.dataset[e])}(t);const e=r.get(t);e&&e.config&&e.config.class&&function(t,e){e&&e.class&&t?.classList&&t.classList.remove(e.class)}(t,e.config),e&&r.delete(t)},getTemplate:function(t){if(t.startsWith("#")){const e=document.querySelector(t);return e?e.innerHTML:null}return t},applyValues:function(t,e,r){Object.entries(e).forEach(([e,n])=>{const s=i(n,r);"textContent"===e?t.textContent=s:"innerHTML"===e?t.innerHTML=s:"className"===e?t.className=s:e.startsWith("data-")?t.dataset[e.slice(5)]=s:t[e]=s})}}}!function(){"use strict";function t(){"undefined"!=typeof htmx&&htmx.defineExtension("optimistic",u(htmx))}"undefined"!=typeof htmx?t():"loading"===document.readyState&&document.addEventListener("DOMContentLoaded",function(){"undefined"!=typeof htmx&&t()})}()})();