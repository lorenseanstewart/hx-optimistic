(()=>{var e="hx-optimistic",t="hx-optimistic-error",n="hx-optimistic-reverting",r="optimistic";function s(e,t){let n=e;for(;n;){const e=n.querySelector(t);if(e)return e;n=n.parentElement}return null}function i(e,t,n={}){return"string"!=typeof e?e:e.replace(/\${([^}]+)}/g,(e,r)=>{if(r=r.trim(),void 0!==n[r])return n[r];if(!t)return e;if("this.value"===r){if(void 0!==t.value)return t.value;if("FORM"===t.tagName){const e=t.querySelector("input, textarea, select");if(e?.value)return e.value}}if("FORM"===t.tagName){const e={textarea:"textarea",email:'input[type="email"]',password:'input[type="password"]',text:'input[type="text"], input:not([type])',url:'input[type="url"]',tel:'input[type="tel"]',search:'input[type="search"]'}[r]||`[name="${r}"]`,n=t.querySelector(e);if(n?.value)return n.value}if("this.textContent"===r)return t.textContent||e;if(r.startsWith("this.dataset.")){const n=r.slice(13);return t.dataset[n]||e}if(r.startsWith("data:")){const n=r.slice(5).replace(/-([a-z])/g,(e,t)=>t.toUpperCase());return t.dataset[n]||e}if(r.startsWith("attr:")){const n=r.slice(5);return t.getAttribute(n)||e}return(r.includes(".")||r.includes(":"))&&console.warn(`[hx-optimistic] Unresolved interpolation pattern: \${${r}}`,"\nSupported patterns:","\n  ${this.value} - element value","\n  ${this.textContent} - element text content","\n  ${this.dataset.key} - data attribute","\n  ${data:key} - data attribute shorthand","\n  ${attr:name} - any attribute","\n  ${textarea}, ${email}, ${password}, etc. - form field by type","\n  ${fieldName} - form field by name","\n  ${status}, ${statusText}, ${error} - error context","\nSee documentation for details."),e})}function a(e,t){if(!t||"this"===t)return e;const n=String(t).trim(),r=n.split(/\s+/);if(["closest","find","next","previous"].some(e=>n.startsWith(e))){let t=e;for(let e=0;e<r.length;){const n=r[e++],i=r[e++]||"";if("closest"===n){let e=t?t.closest(i):null;if(e||(e=s(t,i)),t=e,!t)return null}else if("find"===n){if(!t)return null;let e=t.querySelector(i);if(!e){let n=t.parentElement;for(;n&&!e&&(e=n.querySelector(i),!e);)n=n.parentElement}if(t=e||null,!t)return null}else if("next"===n){if(!t)return null;let e=t.nextElementSibling,n=null;for(;e;){if(e.matches(i)){n=e;break}e=e.nextElementSibling}if(t=n,!t)return null}else{if("previous"!==n)return null;{if(!t)return null;let e=t.previousElementSibling,n=null;for(;e;){if(e.matches(i)){n=e;break}e=e.previousElementSibling}if(t=n,!t)return null}}}return t}return document.querySelector(n)}function o(r,s){r?.classList&&(r.classList.remove(e,t,n),"optimistic"===s?r.classList.add(e):"error"===s?r.classList.add(t):"reverting"===s&&r.classList.add(n))}function l(e,t){if(!e?.dataset?.[r])return null;const n=e.dataset[r],s=t.get(e);if(s&&s.__raw===n)return s.config;let i;try{"true"===n||""===n?i={}:(i=JSON.parse(n),"object"==typeof i&&null!==i||(i={values:{textContent:n}}))}catch(e){i={values:{textContent:n}}}return i.delay=i.delay??2e3,i.errorMode=i.errorMode||"replace",i.errorMessage=i.errorMessage||"Request failed",i.values||i.template||"BUTTON"!==e.tagName||(i.values={className:(e.className+" hx-optimistic-pending").trim()}),t.set(e,{__raw:n,config:i}),i}function c(e){const t=new WeakMap,n=new WeakMap,s=new WeakMap,c=new WeakMap;return{onEvent:function(e,t){"htmx:beforeRequest"===e?this.handleBeforeRequest(t):["htmx:responseError","htmx:swapError","htmx:timeout","htmx:sendError"].includes(e)?this.handleError(t):"htmx:afterSwap"===e&&this.cleanup(t.target)},handleBeforeRequest:function(e){const n=e.target;if(i=n,!Boolean(i?.dataset?.[r]))return;var i;const u=l(n,t);if(!u)return;const f=function(e){const t=e.getAttribute("hx-target");return t?a(e,t):e}(n);if(!f)return void console.warn("[hx-optimistic] Target element not found for:",n);c.set(n,f);const d=function(e,t){const n=(t.get(e)||0)+1;return t.set(e,n),n}(f,s);this.snapshot(f,n,u,d),this.applyOptimistic(f,n,u),o(f,"optimistic"),function(e,t){t&&t.class&&e?.classList&&e.classList.add(t.class)}(f,u)},handleError:function(e){const r=e.detail?.elt||e.target,i=r?.getAttribute("hx-target"),u=(i?a(r,i):null)||c.get(r)||r;if(!u)return;const f=n.get(u),d=f?.config||l(r,t);if(!d)return;const p=s.get(u);f&&f.token!==p||(o(u,"error"),this.showError(u,d,e),d.delay>0&&setTimeout(()=>this.revert(u,p),d.delay))},snapshot:function(e,t,r,s){const i={innerHTML:e.innerHTML,className:e.className,config:r,token:s};n.set(e,i)},applyOptimistic:function(e,t,n){let r=e;if(n.target){const e=a(t,n.target);e&&(r=e)}if(n.template){const e=this.getTemplate(n.template);if(e){const a=i(e,t);"beforeend"===n.swap?r.insertAdjacentHTML("beforeend",a):"afterbegin"===n.swap?r.insertAdjacentHTML("afterbegin",a):(r.innerHTML=a,s=r,"undefined"!=typeof htmx&&"function"==typeof htmx.process&&htmx.process(s))}}else n.values&&this.applyValues(r,n.values,t);var s},showError:function(e,t,n){if(!e.dataset.hxOptimisticErrorShown)if(e.dataset.hxOptimisticErrorShown="true",t.errorTemplate){const r=this.getTemplate(t.errorTemplate);if(r){const s={status:n.detail?.xhr?.status||0,statusText:n.detail?.xhr?.statusText||"Network Error",error:n.detail?.error||"Request failed"},a=i(r,n.detail?.elt||n.target,s);if("append"===t.errorMode){const t=document.createElement("div");t.className="hx-optimistic-error-message",t.innerHTML=a,e.appendChild(t)}else e.innerHTML=a}}else if(t.errorMessage)if("append"===t.errorMode){const n=document.createElement("div");n.className="hx-optimistic-error-message",n.textContent=t.errorMessage,e.appendChild(n)}else e.textContent=t.errorMessage},revert:function(e,t){const r=n.get(e);r&&(void 0!==t&&r.token!==t||(o(e,"reverting"),void 0!==r.innerHTML&&(e.innerHTML=r.innerHTML),void 0!==r.className&&(e.className=r.className),n.delete(e),s.delete(e),this.cleanup(e)))},cleanup:function(e){if(!e)return;o(e,"clean"),e.querySelectorAll(".hx-optimistic-error-message").forEach(e=>e.remove()),function(e){e?.dataset&&Object.keys(e.dataset).filter(e=>e.startsWith("hxOptimistic")).forEach(t=>delete e.dataset[t])}(e);const t=n.get(e);t&&t.config&&t.config.class&&function(e,t){t&&t.class&&e?.classList&&e.classList.remove(t.class)}(e,t.config),t&&n.delete(e)},getTemplate:function(e){if(e.startsWith("#")){const t=document.querySelector(e);return t?t.innerHTML:null}return e},applyValues:function(e,t,n){Object.entries(t).forEach(([t,r])=>{const s=i(r,n);"textContent"===t?e.textContent=s:"innerHTML"===t?e.innerHTML=s:"className"===t?e.className=s:t.startsWith("data-")?e.dataset[t.slice(5)]=s:e[t]=s})}}}!function(){"use strict";function e(){"undefined"!=typeof htmx&&htmx.defineExtension("optimistic",c(htmx))}"undefined"!=typeof htmx?e():"loading"===document.readyState&&document.addEventListener("DOMContentLoaded",function(){"undefined"!=typeof htmx&&e()})}()})();